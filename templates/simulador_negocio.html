{% extends "base.html" %}

{% block title %}Simulador de Negocio Avanzado - Simulador Financiero{% endblock %}

{% block breadcrumb %}
<div class="breadcrumb">
    <div class="container">
        <a href="/">Inicio</a> <span class="separator">/</span> <a href="/simulador">Simuladores</a> <span class="separator">/</span> <span class="current">Plan de Negocio Avanzado</span>
    </div>
</div>
{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <div class="header-with-badge" style="justify-content: center; margin-bottom: 2rem;">
            <h2>Plan de Negocio Avanzado</h2>
            <span class="badge badge-pro">PRO</span>
        </div>
        
        <form id="pro-business-form" class="business-form" style="max-width: 900px;">
            <!-- Basic Info -->
            <div class="form-section">
                <h4 style="border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 1.5rem;"><i class="fas fa-info-circle"></i> 1. Información General</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="business-name">Nombre del Negocio:</label>
                        <input type="text" id="business-name" name="business-name" placeholder="Ej: Mi Cafetería" required>
                    </div>
                    <div class="form-group">
                        <label for="month">Fecha de Inicio:</label>
                        <input type="month" id="month" name="month" required>
                    </div>
                </div>
            </div>

            <!-- Products/Services -->
            <div class="form-section" style="margin-top: 2rem;">
                <h4 style="border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 1rem;"><i class="fas fa-box-open"></i> 2. Ingresos y Costos Variables <span class="help-icon" data-concept="ingresos">?</span></h4>
                <p class="section-desc">Agrega los productos o servicios que venderás mensualmente.</p>
                <div class="table-responsive">
                    <table id="products-table" class="dynamic-table">
                        <thead>
                            <tr>
                                <th>Producto/Servicio</th>
                                <th style="width: 100px;">Cant.</th>
                                <th style="width: 130px;">Precio (Unit)</th>
                                <th style="width: 130px;">Costo (Unit)</th>
                                <th>Subtotal</th>
                                <th style="width: 50px;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Product rows will be added here -->
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 1rem;">
                    <button type="button" id="add-product-btn" class="btn-secondary btn-small">
                        <i class="fas fa-plus"></i> Añadir Producto
                    </button>
                </div>
                <div class="total-display" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-top: 1rem; border: none;">
                    <strong>Total Ingresos Estimados: <span id="total-revenue-display" style="color: #27ae60;">$0.00</span></strong>
                </div>
            </div>

            <!-- Fixed Costs -->
            <div class="form-section" style="margin-top: 2rem;">
                <h4 style="border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 1.5rem;"><i class="fas fa-building"></i> 3. Costos Fijos Mensuales <span class="help-icon" data-concept="costos-fijos">?</span></h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="rent">Alquiler/Local:</label>
                        <input type="number" id="rent" name="rent" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="utilities">Servicios Básicos:</label>
                        <input type="number" id="utilities" name="utilities" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="salaries">Sueldos Administrativos:</label>
                        <input type="number" id="salaries" name="salaries" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="maintenance">Mantenimiento/Otros:</label>
                        <input type="number" id="maintenance" name="maintenance" step="0.01" min="0" value="0">
                    </div>
                </div>
                <div class="total-display" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border: none;">
                    <strong>Total Costos Fijos: <span id="total-fixed-display" style="color: #34495e;">$0.00</span></strong>
                </div>
            </div>

            <!-- Operating Expenses -->
            <div class="form-section" style="margin-top: 2rem;">
                <h4 style="border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 1.5rem;"><i class="fas fa-bullhorn"></i> 4. Gastos Operativos <span class="help-icon" data-concept="gastos">?</span></h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="marketing">Marketing/Publicidad:</label>
                        <input type="number" id="marketing" name="marketing" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="transport">Transporte / Logística:</label>
                        <input type="number" id="transport" name="transport" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="imprevistos">Imprevistos (Ahorro):</label>
                        <input type="number" id="imprevistos" name="imprevistos" step="0.01" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="internet">Telecomunicaciones:</label>
                        <input type="number" id="internet" name="internet" step="0.01" min="0" value="0">
                    </div>
                </div>
                <div class="total-display" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; border: none;">
                    <strong>Total Gastos Operativos: <span id="total-operating-display" style="color: #e67e22;">$0.00</span></strong>
                </div>
            </div>

            <!-- Credit -->
            <div class="form-section" style="margin-top: 2rem;">
                <h4 style="border-bottom: 2px solid #3498db; padding-bottom: 5px; margin-bottom: 1.5rem;"><i class="fas fa-hand-holding-dollar"></i> 5. Crédito (Opcional)</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="credit-amount">Monto:</label>
                        <input type="number" id="credit-amount" name="credit-amount" step="100" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="credit-rate">Tasa Anual (%):</label>
                        <input type="number" id="credit-rate" name="credit-rate" step="0.1" min="0" value="12">
                    </div>
                    <div class="form-group">
                        <label for="credit-term">Plazo (meses):</label>
                        <input type="number" id="credit-term" name="credit-term" min="1" value="12">
                    </div>
                </div>
            </div>

            <div class="form-actions main-actions" style="margin-top: 3rem;">
                <button type="submit" class="btn-primary" style="padding: 15px 40px;">
                    <i class="fas fa-calculator"></i> Generar Proyección
                </button>
                <button type="button" id="save-pro-btn" class="btn-secondary">
                    <i class="fas fa-save"></i> Guardar Proyecto
                </button>
            </div>
            
            <div class="form-actions secondary-actions" style="margin-top: 1.5rem; border-top: 1px solid #eee; padding-top: 1.5rem;">
                <button type="button" onclick="location.reload()" class="btn-secondary btn-small">
                    <i class="fas fa-sync"></i> Nueva Simulación
                </button>
            </div>
        </form>

        <div id="pro-results" class="results" style="display: none; margin-top: 2rem;">
            <!-- Detailed results will be injected here -->
        </div>

        <div id="projections-section" class="projections-section" style="display: none; margin-top: 2rem;">
            <h3>Proyección de Flujo de Caja (12 Meses)</h3>
            <div class="chart-container">
                <canvas id="cashflow-chart"></canvas>
            </div>
            <div class="table-responsive">
                <table id="projections-table" class="data-table">
                    <!-- 12 months projections table -->
                </table>
            </div>
        </div>
    </div>
</section>

<!-- Product Row Template -->
<template id="product-row-template">
    <tr>
        <td><input type="text" class="prod-name" placeholder="Producto A" required></td>
        <td><input type="number" class="prod-qty" value="1" min="1" required></td>
        <td><input type="number" class="prod-price" value="0" min="0" step="0.01" required></td>
        <td><input type="number" class="prod-cost" value="0" min="0" step="0.01" required></td>
        <td class="prod-margin">$0.00</td>
        <td><button type="button" class="btn-delete-row"><i class="fas fa-trash"></i></button></td>
    </tr>
</template>

{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .header-with-badge { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem; }
    .badge-pro { background-color: #f39c12; color: white; padding: 0.2rem 0.6rem; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
    .form-section { background: #fff; border: 1px solid #eee; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; }
    .form-section h3 { margin-bottom: 1rem; border-bottom: 2px solid #3498db; display: inline-block; padding-bottom: 0.2rem; }
    .section-desc { font-size: 0.9rem; color: #666; margin-bottom: 1rem; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
    .dynamic-table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
    .dynamic-table th, .dynamic-table td { padding: 0.8rem; border: 1px solid #eee; text-align: left; }
    .dynamic-table th { background: #f8f9fa; }
    .dynamic-table input { width: 100%; padding: 0.4rem; border: 1px solid #ddd; border-radius: 4px; }
    .btn-delete-row { background: #e74c3c; color: white; border: none; padding: 0.4rem 0.6rem; border-radius: 4px; cursor: pointer; }
    .btn-delete-row:hover { background: #c0392b; }
    .total-display { text-align: right; font-size: 1.1rem; padding: 0.5rem; border-top: 1px solid #eee; margin-top: 0.5rem; }
    .btn-large { padding: 1rem 2rem; font-size: 1.1rem; }
    .chart-container { background: #fff; padding: 1.5rem; border-radius: 8px; border: 1px solid #eee; margin-bottom: 2rem; }
</style>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/simulador_pro.js') }}"></script>
{% endblock %}
